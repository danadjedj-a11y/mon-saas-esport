<!-- 
  CODE POUR GOOGLE SITES
  =======================
  
  INSTRUCTIONS :
  1. Dans Google Sites, cr√©ez ou √©ditez une page
  2. Cliquez sur "Ins√©rer" > "Embed" (Int√©grer) ou "Code"
  3. Collez ce code dans l'√©diteur
  4. MODIFIEZ les valeurs dans la section CONFIG ci-dessous
  5. Ajustez la largeur et la hauteur si n√©cessaire
-->

<div id="tournament-widget-container" style="max-width: 600px; margin: 20px auto;"></div>

<script>
(function() {
    // ============================================
    // CONFIGURATION - √Ä MODIFIER ICI
    // ============================================
    const CONFIG = {
        // URL de base de votre API (remplacer par votre URL de production)
        API_BASE_URL: 'https://mon-saas-esport.vercel.app/api/tournament',
        // OU pour la production :
        // API_BASE_URL: 'https://votre-domaine.com/api/tournament',
        
        // ID du tournoi √† afficher
        TOURNAMENT_ID: '65acf74c-ec4d-4527-9291-51de5b67ca13',
        
        // URL de votre site de tournoi (pour le lien "Voir le bracket")
        TOURNAMENT_URL: 'https://mon-saas-esport.vercel.app/tournament',
        // OU pour la production :
        // TOURNAMENT_URL: 'https://votre-domaine.com/tournament',
    };

    // Styles CSS
    const style = document.createElement('style');
    style.textContent = `
        #tournament-widget-container .tournament-widget {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 20px;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        #tournament-widget-container .tournament-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 15px;
        }
        #tournament-widget-container .tournament-header h2 {
            margin: 0 0 10px 0;
            font-size: 24px;
            font-weight: bold;
        }
        #tournament-widget-container .tournament-header .game {
            font-size: 16px;
            opacity: 0.9;
        }
        #tournament-widget-container .tournament-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        #tournament-widget-container .stat-card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        #tournament-widget-container .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0 5px 0;
        }
        #tournament-widget-container .stat-label {
            font-size: 14px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        #tournament-widget-container .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }
        #tournament-widget-container .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        #tournament-widget-container .bracket-link {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.3);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            transition: background 0.3s;
        }
        #tournament-widget-container .bracket-link:hover {
            background: rgba(255, 255, 255, 0.4);
        }
    `;
    document.head.appendChild(style);

    const container = document.getElementById('tournament-widget-container');
    
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    async function fetchTournamentInfo() {
        try {
            const response = await fetch(`${CONFIG.API_BASE_URL}/${CONFIG.TOURNAMENT_ID}/info`);
            
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Erreur HTTP ${response.status}: ${errorText.substring(0, 100)}`);
            }
            
            // V√©rifier le Content-Type
            const contentType = response.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
                const text = await response.text();
                throw new Error(`L'API n'a pas retourn√© du JSON. Content-Type: ${contentType}, R√©ponse: ${text.substring(0, 200)}`);
            }
            
            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Erreur lors de la r√©cup√©ration des donn√©es:', error);
            throw error;
        }
    }

    function renderTournament(data) {
        const statusColor = {
            'draft': '#f39c12',
            'ongoing': '#2ecc71',
            'completed': '#3498db'
        };

        const statusText = {
            'draft': 'üü† Inscriptions Ouvertes',
            'ongoing': 'üü¢ En Cours',
            'completed': '‚úÖ Termin√©'
        };

        container.innerHTML = `
            <div class="tournament-widget">
                <div class="tournament-header">
                    <h2>${escapeHtml(data.tournament.name)}</h2>
                    <div class="game">${escapeHtml(data.tournament.game)}</div>
                    <div style="margin-top: 10px; font-size: 14px; color: ${statusColor[data.tournament.status] || '#fff'}">
                        ${statusText[data.tournament.status] || data.tournament.status}
                    </div>
                </div>

                <div class="tournament-stats">
                    <div class="stat-card">
                        <div class="stat-label">Participants</div>
                        <div class="stat-value">${data.participants_count}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Matchs</div>
                        <div class="stat-value">${data.matches_count}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Termin√©s</div>
                        <div class="stat-value">${data.completed_matches}</div>
                    </div>
                </div>

                <div style="text-align: center;">
                    <a href="${CONFIG.TOURNAMENT_URL}/${CONFIG.TOURNAMENT_ID}/public" 
                       target="_blank" 
                       class="bracket-link">
                        üìä Voir le Bracket Complet
                    </a>
                </div>

                ${data.tournament.best_of > 1 ? `
                    <div style="text-align: center; margin-top: 15px; font-size: 14px; opacity: 0.9;">
                        üéÆ Format: Best-of-${data.tournament.best_of}
                    </div>
                ` : ''}
            </div>
        `;
    }

    function renderError(error) {
        let errorMessage = error.message || 'Erreur inconnue';
        
        // Messages d'erreur plus clairs
        if (errorMessage.includes('JSON.parse')) {
            errorMessage = 'L\'API n\'a pas retourn√© du JSON valide. V√©rifiez que l\'URL de l\'API est correcte.';
        } else if (errorMessage.includes('Failed to fetch') || errorMessage.includes('NetworkError')) {
            errorMessage = 'Impossible d\'acc√©der √† l\'API. V√©rifiez que l\'URL est correcte et que l\'API est accessible.';
        } else if (errorMessage.includes('404')) {
            errorMessage = 'L\'API n\'a pas √©t√© trouv√©e (404). V√©rifiez que l\'URL et l\'ID du tournoi sont corrects.';
        } else if (errorMessage.includes('500')) {
            errorMessage = 'Erreur serveur (500). L\'API rencontre un probl√®me.';
        }
        
        container.innerHTML = `
            <div class="error">
                ‚ùå Erreur lors du chargement des donn√©es<br>
                <small style="font-size: 12px; margin-top: 10px; display: block;">${escapeHtml(errorMessage)}</small>
                <small style="font-size: 11px; margin-top: 5px; display: block; opacity: 0.8;">
                    URL test√©e: ${CONFIG.API_BASE_URL}/${CONFIG.TOURNAMENT_ID}/info
                </small>
            </div>
        `;
    }

    function renderLoading() {
        container.innerHTML = '<div class="loading">Chargement des donn√©es du tournoi...</div>';
    }

    async function init() {
        renderLoading();
        try {
            const data = await fetchTournamentInfo();
            renderTournament(data);
        } catch (error) {
            renderError(error);
        }
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
})();
</script>

